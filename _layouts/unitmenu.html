<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dynamic Units Menu</title>
  <style>
    body {
      margin: 0;
      padding: 0;
    }
    nav ul {
      list-style-type: none;
      padding: 10px;
      background-color: #f8f8f8;
      border-bottom: 1px solid #ddd;
    }
    nav ul li {
      display: inline;
      margin-right: 10px;
    }
    main {
      padding: 20px;
      margin-top: 20px; /* Adjusting margin to prevent clipping */
    }
  </style>
  <!-- Load the marked library -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Ensure marked is defined
      if (typeof marked === 'undefined') {
        console.error('Marked library is not loaded properly.');
        return;
      } else {
        console.log('Marked library loaded successfully.');
      }

      function stripFrontMatter(content) {
        const frontMatterPattern = /^---[\s\S]+?---/;
        return content.replace(frontMatterPattern, '').trim();
      }

      function loadPage(unit, lesson) {
        fetch(`/balkeon/letslearn/${unit}/${lesson}`)
          .then(response => response.text())
          .then(data => {
            const strippedContent = stripFrontMatter(data);
            document.getElementById('content').innerHTML = marked.parse(strippedContent);
            console.log('Loaded page:', lesson); // Debugging line
          })
          .catch(error => console.error('Error loading page:', error));
      }

      function loadUnitsMenu() {
        fetch(`/balkeon/letslearn/unitsmenu`)
          .then(response => response.text())
          .then(data => {
            const strippedContent = stripFrontMatter(data);
            document.getElementById('content').innerHTML = marked.parse(strippedContent);
            console.log('Loaded units menu'); // Debugging line
            addUnitLinks(); // Adding links dynamically
          })
          .catch(error => console.error('Error loading units menu:', error));
      }

      function addUnitLinks() {
        const units = document.querySelectorAll('#content a[data-unit]');
        units.forEach(unit => {
          unit.addEventListener('click', function(event) {
            event.preventDefault();
            const unitId = this.getAttribute('data-unit');
            console.log('Unit clicked:', unitId); // Debugging line
            loadLessonsMenu(unitId);
          });
        });
      }

      function loadLessonsMenu(unit) {
        fetch(`/balkeon/letslearn/${unit}/lessonsmenu`)
          .then(response => response.text())
          .then(data => {
            const strippedContent = stripFrontMatter(data);
            document.getElementById('content').innerHTML = marked.parse(strippedContent);
            console.log('Loaded lessons menu:', unit); // Debugging line
            addLessonLinks(unit); // Adding links dynamically
          })
          .catch(error => console.error('Error loading lessons menu:', error));
      }

      function addLessonLinks(unit) {
        const lessons = document.querySelectorAll('#content a[data-lesson]');
        lessons.forEach(lesson => {
          lesson.addEventListener('click', function(event) {
            event.preventDefault();
            const lessonId = this.getAttribute('data-lesson');
            console.log('Lesson clicked:', lessonId); // Debugging line
            loadPage(unit, lessonId);
          });
        });
      }

      // Initialize with units menu
      loadUnitsMenu();

      // Add event listeners for nav links
      document.querySelectorAll('nav ul li a').forEach(link => {
        link.addEventListener('click', function(event) {
          event.preventDefault();
          loadUnitsMenu();
        });
      });
    });
  </script>
</head>
<body>
  <nav>
    <ul>
      <li><a href="#">Units Menu</a></li>
    </ul>
  </nav>
  <main id="content">
    <!-- Content will be loaded here -->
  </main>
</body>
</html>
