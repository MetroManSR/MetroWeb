<!DOCTYPE html>
<html>
<head>
    <title>Simple OSM Tile Map</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f0f0f0;
        }
        #map-container {
            margin: 0 auto;
            max-width: 1200px;
        }
        #map {
            display: grid;
            grid-template-columns: repeat(auto-fill, 64px);
            gap: 0;
            background: #e0e0e0;
            border: 1px solid #999;
        }
        .tile {
            width: 64px;
            height: 64px;
            background-size: cover;
            image-rendering: pixelated;
        }
        #controls {
            margin: 20px 0;
            padding: 15px;
            background: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        #coords {
            font-family: monospace;
            margin: 10px 0;
            padding: 8px;
            background: #eee;
            border-radius: 3px;
        }
        button, input {
            padding: 8px 12px;
            margin-right: 5px;
            margin-bottom: 5px;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0,0,0,0.1);
            border-radius: 50%;
            border-top-color: #333;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <h1>Simple OSM Tile Map (Zoom 12)</h1>
    
    <div id="controls">
        <div>
            <input type="number" id="latInput" placeholder="Latitude" value="40.7128" step="0.0001">
            <input type="number" id="lonInput" placeholder="Longitude" value="-74.0060" step="0.0001">
            <button id="goToCoords">Go</button>
        </div>
        <div id="coords">Latitude: 40.7128, Longitude: -74.0060</div>
        <div>
            <button id="moveNorth">↑ North</button>
            <button id="moveSouth">↓ South</button>
            <button id="moveWest">← West</button>
            <button id="moveEast">→ East</button>
            <button id="zoomIn">+ Zoom In</button>
            <button id="zoomOut">- Zoom Out</button>
        </div>
        <div id="status">Ready</div>
    </div>
    
    <div id="map-container">
        <div id="map"></div>
    </div>

    <script>
        // Configuration
        const TILE_SIZE = 256; // OSM tile size in pixels
        const DISPLAY_SIZE = 64; // How big to display each tile in pixels
        const ZOOM = 12; // Fixed zoom level
        const TILES_X = 10; // Number of tiles horizontally
        const TILES_Y = 10; // Number of tiles vertically
        
        // State
        let centerLat = 40.7128; // New York
        let centerLon = -74.0060;
        let isLoading = false;
        
        // Convert lat/lon to tile numbers
        function latLonToTile(lat, lon, zoom) {
            const x = Math.floor((lon + 180) / 360 * Math.pow(2, zoom));
            const y = Math.floor((1 - Math.log(Math.tan(lat * Math.PI / 180) + 1 / Math.cos(lat * Math.PI / 180)) / Math.PI) / 2 * Math.pow(2, zoom));
            return { x, y };
        }
        
        // Convert tile numbers to lat/lon of top-left corner
        function tileToLatLon(x, y, zoom) {
            const n = Math.pow(2, zoom);
            const lon = x / n * 360 - 180;
            const lat = Math.atan(Math.sinh(Math.PI * (1 - 2 * y / n))) * 180 / Math.PI;
            return { lat, lon };
        }
        
        // Generate tile URL
        function getTileUrl(x, y, zoom) {
            return `https://tile.openstreetmap.org/${zoom}/${x}/${y}.png`;
        }
        
        // Load and display tiles
        async function loadTiles() {
            if (isLoading) return;
            isLoading = true;
            updateStatus("Loading tiles...");
            
            const centerTile = latLonToTile(centerLat, centerLon, ZOOM);
            const startX = centerTile.x - Math.floor(TILES_X / 2);
            const startY = centerTile.y - Math.floor(TILES_Y / 2);
            
            const mapElement = document.getElementById('map');
            mapElement.innerHTML = '';
            
            try {
                for (let y = 0; y < TILES_Y; y++) {
                    for (let x = 0; x < TILES_X; x++) {
                        const tileX = startX + x;
                        const tileY = startY + y;
                        
                        const tileElement = document.createElement('div');
                        tileElement.className = 'tile';
                        tileElement.style.backgroundImage = `url(${getTileUrl(tileX, tileY, ZOOM)})`;
                        tileElement.title = `Tile X: ${tileX}, Y: ${tileY}, Z: ${ZOOM}`;
                        
                        mapElement.appendChild(tileElement);
                        
                        // Add a small delay between requests to avoid overloading
                        if ((y * TILES_X + x) % 5 === 0) {
                            await new Promise(resolve => setTimeout(resolve, 50));
                        }
                    }
                }
                updateStatus(`Loaded ${TILES_X * TILES_Y} tiles at zoom ${ZOOM}`);
                updateCoords();
            } catch (error) {
                console.error("Error loading tiles:", error);
                updateStatus("Error loading tiles");
            } finally {
                isLoading = false;
            }
        }
        
        // Move the map
        function moveMap(dLat, dLon) {
            centerLat += dLat;
            centerLon += dLon;
            loadTiles();
        }
        
        // Update coordinate display
        function updateCoords() {
            document.getElementById('coords').textContent = 
                `Latitude: ${centerLat.toFixed(4)}, Longitude: ${centerLon.toFixed(4)}`;
        }
        
        // Update status message
        function updateStatus(msg) {
            document.getElementById('status').textContent = msg;
        }
        
        // Go to specific coordinates
        function goToCoordinates() {
            const lat = parseFloat(document.getElementById('latInput').value);
            const lon = parseFloat(document.getElementById('lonInput').value);
            
            if (isNaN(lat) || isNaN(lon) || lat < -90 || lat > 90 || lon < -180 || lon > 180) {
                alert("Please enter valid coordinates\nLatitude: -90 to 90\nLongitude: -180 to 180");
                return;
            }
            
            centerLat = lat;
            centerLon = lon;
            loadTiles();
        }
        
        // Initialize
        document.getElementById('moveNorth').addEventListener('click', () => moveMap(0.02, 0));
        document.getElementById('moveSouth').addEventListener('click', () => moveMap(-0.02, 0));
        document.getElementById('moveWest').addEventListener('click', () => moveMap(0, -0.02));
        document.getElementById('moveEast').addEventListener('click', () => moveMap(0, 0.02));
        document.getElementById('goToCoords').addEventListener('click', goToCoordinates);
        
        // Zoom buttons are disabled since we're fixing zoom at 12
        document.getElementById('zoomIn').disabled = true;
        document.getElementById('zoomOut').disabled = true;
        
        // Load initial tiles
        loadTiles();
    </script>
</body>
</html>
